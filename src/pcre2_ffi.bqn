âŸ¨
  void, ptr, i32, u32, u64
  c8str, c16str, c32str, utf8str
  mc8str, mc16str, mc32str, mUtf8str
âŸ© â† â€¢Import "bqn_ffi.bqn"

cwâ€¿strâ€¿mstr â† â€¢args.mode âŠ‘Â¨âŸ¨
  "8"â€¿"16"â€¿"32"â€¿"8"
  c8strâ€¿c16strâ€¿c32strâ€¿utf8str
  mc8strâ€¿mc16strâ€¿mc32strâ€¿mutf8str
âŸ©

pcre2_so â† â€¢args.pcre2parentfolderâˆ¾"libpcre2-"âˆ¾cwâˆ¾".so" #TODO check path and give error message if not found

bm32 â† i32
M â† "&"âŠ¸âˆ¾
W â† ">ğ•¨"âŠ¸âˆ¾
X â† ">"âŠ¸âˆ¾

_pcre2 â† { pcre2_so â€¢FFI âŸ¨ğ•¨âŸ© âˆ¾ âŸ¨"pcre2_"âˆ¾ğ•—âˆ¾"_"âˆ¾cwâŸ© âˆ¾ (â‹ˆ">"âˆ¾âŠ¢)âŸ(1â‰¡â‰¡)ğ•©}

code_free                      â‡ void "code_free"                     _pcre2 ptr
compile                        â‡ ptr  "compile"                       _pcre2 âŸ¨ptr, u64, bm32, M i32, M u32, ptrâŸ©
# get_error_message              â‡ i32  "get_error_message "            _pcre2 âŸ¨i32, mc8str, u32âŸ©
get_error_message              â‡ i32  "get_error_message"             _pcre2 âŸ¨i32, mstr, u32âŸ©
get_ovector_pointer            â‡ ptr  "get_ovector_pointer"           _pcre2 ptr
jit_compile                    â‡ i32  "jit_compile"                   _pcre2 âŸ¨ptr, bm32âŸ©
match                          â‡ i32  "match"                         _pcre2 âŸ¨ptr, ptr, u64, u64, bm32, ptr, ptrâŸ©
match_data_create_from_pattern â‡ ptr  "match_data_create_from_pattern"_pcre2 âŸ¨ptr, ptrâŸ©
match_data_free                â‡ void "match_data_free"               _pcre2 ptr
substitute                     â‡ i32  "substitute"                    _pcre2 âŸ¨ptr, ptr, u64, u64, bm32, ptr, ptr, str, u64, mstr, M u32âŸ©
substring_list_free            â‡ void "substring_list_free"           _pcre2 ptr
substring_list_get             â‡ i32  "substring_list_get"            _pcre2 âŸ¨ptr, M ptr, M ptrâŸ©
# pattern_info                   â‡ i32  "pattern_info"                  _pcre2 âŸ¨ptr, u32, M u32âŸ©

match_context_create           â‡ ptr  "match_context_create"          _pcre2 ptr
match_context_free             â‡ void "match_context_free"            _pcre2 ptr

set_depth_limit                â‡ i32  "set_depth_limit"               _pcre2 âŸ¨W ptr, X u32âŸ©
set_match_limit                â‡ i32  "set_match_limit"               _pcre2 âŸ¨W ptr, X u32âŸ©
set_heap_limit                 â‡ i32  "set_heap_limit"                _pcre2 âŸ¨W ptr, X u32âŸ©
set_offset_limit               â‡ i32  "set_offset_limit"              _pcre2 âŸ¨W ptr, X u64âŸ©
