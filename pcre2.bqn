âŸ¨SetOptionsâŸ© â† â€¢Import "src/pcre2_options.bqn"
global_options â† â€¢args SetOptionsâŸ(6â‰¡â€¢Typeâˆ˜âŠ£) SetOptions â€¢Import "defaults.bqn"

pcre2_fns â† global_options â€¢Import "src/pcre2_fns.bqn"

Compile â‡ {
  options ğ•Š pattern:
    o â† options SetOptions global_options
    ce â† pcre2_fns.Compile âŸ¨pattern, oâŸ©

    pcre2_fns.CompileJitâŸo.usejit âŸ¨âŠ‘ce, o.jitâŸ©

    MatchType â† {ğ•Š f: {
              ğ•Š text: F âŸ¨ce, text, o.matchâŸ©;
      options ğ•Š text: F âŸ¨ce, text, (options SetOptions o).matchâŸ©
    }}

    test     â‡ MatchType pcre2_fns.test
    match    â‡ MatchType pcre2_fns.match
    imatch   â‡ MatchType pcre2_fns.imatch
    matchall â‡ MatchType pcre2_fns.matchall

    ReplaceType â† {ğ•Š f: {
              pattern _ğ•£ text: pattern F âŸ¨ce, text, o.subâŸ©;
      options pattern _ğ•£ text: pattern F âŸ¨ce, text, (options SetOptions o).subâŸ©
    }}

    replace    â‡ ReplaceType pcre2_fns.replace
    replaceall â‡ ReplaceType pcre2_fns.replaceall

    FErr â† "Compiled expression was already freed"!0Ë™
    Free â‡ {ğ•Š:
      pcre2_fns.CEFree ce
      testâ€¿matchâ€¿imatchâ€¿matchallâ€¿replaceâ€¿replaceallâ€¿free fErrË™Â¨â†©
      @
    }
;
  ğ•Š pattern: {â‡} ğ•Š pattern
}


_MatchAll â‡ { ğ•¨ pattern _ğ•£ text:
  re â† ğ•¨ Compile pattern
  re.FreeâŠ¸âŠ¢ re.MatchAll text
}

_ReplaceAll_ â‡ { ğ•¨ pattern _ğ•£_ replacement text:
  re â† ğ•¨ Compile pattern
  re.FreeâŠ¸âŠ¢ replacement re._ReplaceAll text
}
