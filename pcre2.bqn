null â† 8â¥Š0

hasField â† @ â€¢FFI "i8"â€¿"bqn_hasField"â€¿">ğ•¨a"â€¿">ğ•©a"
getField â† @ â€¢FFI "a"â€¿"bqn_getField"â€¿">ğ•¨a"â€¿">ğ•©a"
Get â† HasfieldâŸœâŠ‘â—¶âŸ¨1âŠ¸âŠ‘, GetfieldâŸœâŠ‘âŸ©

opt â† Ã—âˆ˜â‰ â—¶âŸ¨{â‡}, ("â€¢arg 0 not a namespace"!6â‰¡â€¢Type)âŠ¸âŠ¢âŠ‘âŸ© â€¢args

# Defaults
utf       â† opt GetâŸ¨"utf",       8âŸ©
jit       â† opt GetâŸ¨"jit",       1âŸ©
bufsize   â† opt GetâŸ¨"bufsize",   0âŸ©
multiline â† opt GetâŸ¨"multiline", 1âŸ©
greedy    â† opt GetâŸ¨"greedy",    1âŸ©
anchored  â† opt GetâŸ¨"anchored",  0âŸ©
caseless  â† opt GetâŸ¨"caseless",  0âŸ©
extended  â† opt GetâŸ¨"extended",  0âŸ©
overlap   â† opt GetâŸ¨"overlap",   0âŸ©
substitute_extended â† opt GetâŸ¨"substitute_extended", 0âŸ©

fileâ€¿chartype â† (âŠ‘ 8â€¿16â€¿32 âŠ utf)âŠ‘âŸ¨
  "bqn-pcre2-8.so"â€¿"*u8:c8"
  "bqn-pcre2-16.so"â€¿"*u16:c16"
  "bqn-pcre2-32.so"â€¿"*u32:c32"
âŸ©

pcre2_compile  â† file â€¢FFI âŸ¨"i32", "compile", chartype, "&*:i8", "i8", "i8", "i8", "i8", "i8", "i8"âŸ©
pcre2_test     â† file â€¢FFI âŸ¨"i8", "test", ">ğ•¨*:i8", ">ğ•©"âˆ¾chartypeâŸ©
pcre2_match    â† file â€¢FFI âŸ¨"a", "match", ">ğ•¨*:i8", ">ğ•©"âˆ¾chartypeâŸ©
pcre2_imatch   â† file â€¢FFI âŸ¨"a", "imatch", ">ğ•¨*:i8", ">ğ•©"âˆ¾chartypeâŸ©
pcre2_matchall â† file â€¢FFI âŸ¨"a", "matchall", ">ğ•¨*:i8", chartype, "i8"âŸ©
pcre2_replace  â† file â€¢FFI âŸ¨"a", "replace", ">ğ•¨*:i8", chartype, chartype, "u64", "i8"âŸ©
pcre2_re_free  â† file â€¢FFI âŸ¨"", "re_free", ">*:i8"âŸ©


Compile â‡ {
    ğ•Š ğ•©: {â‡}ğ•Šğ•©;
  o ğ•Š pattern:

    jit       â†  o GetâŸ¨"jit", jitâŸ©
    multiline â†  o GetâŸ¨"multiline", multilineâŸ©
    greedy    â†  o GetâŸ¨"greedy", greedyâŸ©
    anchored  â†  o GetâŸ¨"anchored", anchoredâŸ©
    caseless  â†  o GetâŸ¨"caseless", caselessâŸ©
    extended  â†  o GetâŸ¨"extended", extendedâŸ©
    overlap   â†  o GetâŸ¨"overlap", overlapâŸ©
    substitute_extended â† o GetâŸ¨"substitute_extended", substitute_extendedâŸ©

    "Regex error"!âŠ‘Â·â€¿re â† PCRE2_Compile âŸ¨ patternâˆ¾@, null, jit, multiline, greedy, anchored, caseless, extendedâŸ©

    fâ†0 â‹„ Free â‡ {Â·: PCRE2_RE_Free re â‹„ fâ†©1}
    ferr â† "Compiled expession was already freed"

    Test        â‡ {ferr!Â¬f â‹„ re PCRE2_Test   ğ•©âˆ¾@}
    Match       â‡ {ferr!Â¬f â‹„ re PCRE2_Match  ğ•©âˆ¾@}
    IMatch      â‡ {ferr!Â¬f â‹„ re PCRE2_IMatch ğ•©âˆ¾@}
    Matchall    â‡ {ferr!Â¬f â‹„ re PCRE2_MatchAll âŸ¨ğ•©âˆ¾@, (ğ•¨âŠ£{â‡}) GetâŸ¨"overlap", overlapâŸ©âŸ©}
    _Replace    â‡ {ferr!Â¬f â‹„ re PCRE2_Replace  âŸ¨ğ•—âˆ¾@, ğ•©âˆ¾@, bufsize, 0, substitute_extendedâŸ©}
    _Replaceall â‡ {ferr!Â¬f â‹„ re PCRE2_Replace  âŸ¨ğ•—âˆ¾@, ğ•©âˆ¾@, bufsize, 1, (ğ•¨âŠ£{â‡}) GetâŸ¨"extended", substitute_extendedâŸ©âŸ©}

}

_MatchAll â‡ {
  ğ•—_ğ•£ ğ•©: {â‡} ğ•—_ğ•£ ğ•©;
  o pattern _ğ•£ ğ•©:
    re â† o Compile pattern
    {Â·:re.Free@}âŠ¸âŠ¢ re.MatchAll ğ•©
}

_ReplaceAll_ â‡ {
  ğ•—_ğ•£_ğ•˜ ğ•©: {â‡} ğ•—_ğ•£_ğ•˜ ğ•©;
  o pattern _ğ•£_ replacement ğ•©:
    re â† o Compile pattern
    {Â·:re.Free@}âŠ¸âŠ¢ replacement re._ReplaceAll ğ•©
}
